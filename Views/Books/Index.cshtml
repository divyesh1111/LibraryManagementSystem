@model LibraryManagementSystem.ViewModels.BookListViewModel
@{
    ViewData["Title"] = "Books";
}

<div class="space-y-8">

    <!-- ================= HEADER ================= -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h2 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                <i class="fas fa-book text-primary-600"></i>
                Library Books
            </h2>
            <p class="text-gray-500 mt-1">Manage and monitor your book inventory efficiently</p>
        </div>

        <a href="/Books/Create"
           class="inline-flex items-center gap-2 bg-primary-600 text-white px-5 py-2.5 rounded-lg shadow hover:bg-primary-700 transition duration-200">
            <i class="fas fa-plus"></i>
            Add New Book
        </a>
    </div>


    <!-- ================= FILTER CARD ================= -->
    <div class="bg-white rounded-xl shadow-md p-6 border border-gray-100">
        <form method="get" class="grid grid-cols-1 md:grid-cols-6 gap-4">

            <!-- Search -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                <input type="text"
                       name="searchTerm"
                       value="@Model.SearchTerm"
                       placeholder="Search by title, ISBN or author..."
                       class="w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500 px-3 py-2 shadow-sm border">
            </div>

            <!-- Category -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                <select name="categoryFilter"
                        class="w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500 px-3 py-2 shadow-sm border">
                    <option value="">All</option>
                    @foreach (var cat in Model.Categories ?? Enumerable.Empty<SelectListItem>())
                    {
                        <option value="@cat.Value" selected="@(Model.CategoryFilter.ToString() == cat.Value)">
                            @cat.Text
                        </option>
                    }
                </select>
            </div>

            <!-- Sort -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Sort</label>
                <select name="sortBy"
                        class="w-full rounded-lg border-gray-300 focus:ring-primary-500 focus:border-primary-500 px-3 py-2 shadow-sm border">
                    <option value="">Title (A-Z)</option>
                    <option value="title_desc" selected="@(Model.SortBy == "title_desc")">Title (Z-A)</option>
                    <option value="author" selected="@(Model.SortBy == "author")">Author</option>
                    <option value="newest" selected="@(Model.SortBy == "newest")">Newest</option>
                    <option value="oldest" selected="@(Model.SortBy == "oldest")">Oldest</option>
                </select>
            </div>

            <!-- Available Only -->
            <div class="flex items-center mt-6">
                <input type="checkbox"
                       name="availableOnly"
                       value="true"
                       class="h-4 w-4 text-primary-600 rounded border-gray-300"
                       @(Model.AvailableOnly == true ? "checked" : "")>
                <span class="ml-2 text-sm text-gray-700">Available Only</span>
            </div>

            <!-- Buttons -->
            <div class="flex items-end gap-2">
                <button type="submit"
                        class="w-full bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition">
                     Search
                </button>

                <a href="/Books"
                   class="w-full text-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
                    Clear
                </a>
            </div>
        </form>
    </div>


    <!-- ================= RESULTS INFO ================= -->
    <div class="flex justify-between items-center">
        <p class="text-sm text-gray-600">
            Showing
            <span class="font-semibold">@(((Model.PageNumber - 1) * Model.PageSize) + 1)</span>
            -
            <span class="font-semibold">@Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount)</span>
            of
            <span class="font-semibold">@Model.TotalCount</span> books
        </p>
    </div>


    <!-- ================= BOOK GRID ================= -->
    @if (Model.Books.Any())
    {
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            @foreach (var book in Model.Books)
            {
                <div class="bg-white rounded-2xl shadow hover:shadow-xl transition duration-300 overflow-hidden group">

                    <!-- Cover -->
                    <div class="relative h-56 bg-gray-100">
                        @if (!string.IsNullOrEmpty(book.CoverImageUrl))
                        {
                            <img src="@book.CoverImageUrl"
                                 alt="@book.Title"
                                 class="w-full h-full object-contain group-hover:scale-105 transition duration-300">
                        }
                        else
                        {
                            <div class="flex items-center justify-center h-full text-gray-400">
                                <i class="fas fa-book text-5xl"></i>
                            </div>
                        }

                        <span class="absolute top-3 right-3 text-xs px-3 py-1 rounded-full font-semibold
                            @(book.AvailableCopies > 0 ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")">
                            @(book.AvailableCopies > 0 ? $"{book.AvailableCopies} Available" : "Out of Stock")
                        </span>
                    </div>

                    <!-- Content -->
                    <div class="p-5 space-y-2">
                        <h3 class="font-semibold text-lg text-gray-900 truncate">
                            @book.Title
                        </h3>

                        <p class="text-sm text-gray-600">by @book.AuthorName</p>

                        @if (!string.IsNullOrEmpty(book.CategoryName))
                        {
                            <span class="inline-block bg-primary-100 text-primary-700 text-xs px-2 py-1 rounded-full">
                                @book.CategoryName
                            </span>
                        }

                        <p class="text-xs text-gray-500">ISBN: @book.ISBN</p>

                        @if (book.Price.HasValue)
                        {
                            <p class="text-lg font-bold text-primary-600">
                                $@book.Price.Value.ToString("F2")
                            </p>
                        }

                        <div class="flex gap-2 pt-3">
                            <a href="/Books/Details/@book.Id"
                               class="flex-1 text-center py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition">
                                View
                            </a>
                            <a href="/Books/Edit/@book.Id"
                               class="flex-1 text-center py-2 text-sm bg-primary-600 text-white hover:bg-primary-700 rounded-lg transition">
                                Edit
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div class="bg-white rounded-xl shadow-md p-12 text-center">
            <i class="fas fa-book-open text-5xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-800">No Books Found</h3>
            <p class="text-gray-500 mt-2">Try adjusting filters or add a new book.</p>

            <a href="/Books/Create"
               class="inline-block mt-6 bg-primary-600 text-white px-5 py-2 rounded-lg hover:bg-primary-700 transition">
                Add New Book
            </a>
        </div>
    }


    <!-- ================= PAGINATION ================= -->
    @if (Model.TotalPages > 1)
    {
        <div class="flex justify-center">
            <div class="flex items-center gap-2 bg-white px-6 py-3 rounded-xl shadow">

                @if (Model.PageNumber > 1)
                {
                    <a href="?pageNumber=@(Model.PageNumber - 1)&searchTerm=@Model.SearchTerm&categoryFilter=@Model.CategoryFilter&sortBy=@Model.SortBy&availableOnly=@Model.AvailableOnly"
                       class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                }

                @for (int i = Math.Max(1, Model.PageNumber - 2); i <= Math.Min(Model.TotalPages, Model.PageNumber + 2); i++)
                {
                    <a href="?pageNumber=@i&searchTerm=@Model.SearchTerm&categoryFilter=@Model.CategoryFilter&sortBy=@Model.SortBy&availableOnly=@Model.AvailableOnly"
                       class="px-4 py-1 rounded-lg font-medium
                            @(i == Model.PageNumber ? "bg-primary-600 text-white" : "bg-gray-100 hover:bg-gray-200")">
                        @i
                    </a>
                }

                @if (Model.PageNumber < Model.TotalPages)
                {
                    <a href="?pageNumber=@(Model.PageNumber + 1)&searchTerm=@Model.SearchTerm&categoryFilter=@Model.CategoryFilter&sortBy=@Model.SortBy&availableOnly=@Model.AvailableOnly"
                       class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                }
            </div>
        </div>
    }

</div>
