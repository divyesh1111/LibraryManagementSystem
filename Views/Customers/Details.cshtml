@model LibraryManagementSystem.ViewModels.CustomerDetailsViewModel
@{
    ViewData["Title"] = Model.FullName;
}

<div class="max-w-6xl mx-auto">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="/Customers" class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700">
            <i class="fas fa-arrow-left mr-2"></i> Back to Customers
        </a>
    </div>

    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="md:flex">
            <!-- Customer Photo -->
            <div class="md:w-1/3 p-6 bg-gray-50">
                @if (!string.IsNullOrEmpty(Model.ProfileImageUrl))
                {
                    <img src="@Model.ProfileImageUrl" alt="@Model.FullName" class="w-full rounded-lg shadow-md">
                }
                else
                {
                    <div class="w-full aspect-square bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-6xl font-bold">@Model.FirstName[0]@Model.LastName[0]</span>
                    </div>
                }

                <!-- Library Card -->
                <div class="mt-6 bg-gradient-to-r from-green-600 to-green-700 rounded-lg p-4 text-white">
                    <p class="text-xs uppercase tracking-wide opacity-80">Library Card</p>
                    <p class="text-lg font-mono font-bold mt-1">@(Model.LibraryCardNumber ?? "N/A")</p>
                    <p class="text-sm mt-2">@Model.FullName</p>
                </div>

                <!-- Status Badge -->
                <div class="mt-4">
                    @if (Model.IsActiveMember)
                    {
                        <span class="inline-flex items-center w-full justify-center rounded-full bg-green-100 px-4 py-2 text-sm font-medium text-green-800">
                            <i class="fas fa-check-circle mr-2"></i> Active Member
                        </span>
                    }
                    else
                    {
                        <span class="inline-flex items-center w-full justify-center rounded-full bg-gray-100 px-4 py-2 text-sm font-medium text-gray-800">
                            <i class="fas fa-times-circle mr-2"></i> Inactive
                        </span>
                    }
                </div>

                <!-- Actions -->
                <div class="mt-6 space-y-2">
                    <a href="/Customers/Edit/@Model.Id" class="w-full inline-flex justify-center items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                        <i class="fas fa-edit mr-2"></i> Edit Customer
                    </a>
                    <a href="/BookLoans/Create?customerId=@Model.Id" class="w-full inline-flex justify-center items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                        <i class="fas fa-book mr-2"></i> New Loan
                    </a>
                    <a href="/Customers/Delete/@Model.Id" class="w-full inline-flex justify-center items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                        <i class="fas fa-trash mr-2"></i> Delete
                    </a>
                </div>
            </div>

            <!-- Customer Details -->
            <div class="md:w-2/3 p-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">@Model.FullName</h1>
                        <p class="text-lg text-gray-600 mt-1">
                            <i class="fas fa-calendar-alt mr-2"></i>Member since @Model.MembershipDate.ToString("MMMM yyyy")
                        </p>
                    </div>
                    @if (Model.ActiveLoansCount > 0)
                    {
                        <span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800">
                            <i class="fas fa-book mr-1"></i> @Model.ActiveLoansCount Active Loans
                        </span>
                    }
                </div>

                <!-- Customer Info Grid -->
                <div class="mt-6 grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-500">Email</p>
                        <a href="mailto:@Model.Email" class="font-medium text-green-600 hover:underline">@Model.Email</a>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-500">Phone</p>
                            <p class="font-medium text-gray-900">@Model.PhoneNumber</p>
                        </div>
                    }
                    @if (Model.DateOfBirth.HasValue)
                    {
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-500">Date of Birth</p>
                            <p class="font-medium text-gray-900">@Model.DateOfBirth.Value.ToString("MMMM dd, yyyy")</p>
                        </div>
                    }
                    @if (Model.MembershipExpiry.HasValue)
                    {
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-500">Membership Expiry</p>
                            <p class="font-medium @(Model.MembershipExpiry.Value < DateTime.Now ? "text-red-600" : "text-gray-900")">
                                @Model.MembershipExpiry.Value.ToString("MMMM dd, yyyy")
                            </p>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.PreferredBranchName))
                    {
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-500">Preferred Branch</p>
                            <a href="/LibraryBranches/Details/@Model.PreferredBranchId" class="font-medium text-green-600 hover:underline">
                                @Model.PreferredBranchName
                            </a>
                        </div>
                    }
                </div>

                <!-- Address -->
                @if (!string.IsNullOrEmpty(Model.Address))
                {
                    <div class="mt-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Address</h3>
                        <p class="text-gray-600">
                            @Model.Address<br>
                            @if (!string.IsNullOrEmpty(Model.City))
                            {
                                @Model.City@(string.IsNullOrEmpty(Model.PostalCode) ? "" : $", {Model.PostalCode}")<br>
                            }
                            @Model.Country
                        </p>
                    </div>
                }

                <!-- Timestamps -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>Added: @Model.CreatedDate.ToString("MMM dd, yyyy")</span>
                        @if (Model.UpdatedDate.HasValue)
                        {
                            <span>Last Updated: @Model.UpdatedDate.Value.ToString("MMM dd, yyyy")</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Loans -->
    @if (Model.RecentLoans != null && Model.RecentLoans.Any())
    {
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-history text-blue-500 mr-2"></i>Recent Loans
            </h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Book</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Loan Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Due Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fine</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        @foreach (var loan in Model.RecentLoans)
                        {
                            <tr>
                                <td class="px-4 py-3 text-sm text-gray-900">@loan.BookTitle</td>
                                <td class="px-4 py-3 text-sm text-gray-500">@loan.LoanDate.ToString("MMM dd, yyyy")</td>
                                <td class="px-4 py-3 text-sm text-gray-500">@loan.DueDate.ToString("MMM dd, yyyy")</td>
                                <td class="px-4 py-3">
                                    @if (loan.Status == LibraryManagementSystem.Models.LoanStatus.Active)
                                    {
                                        <span class="inline-flex rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800">Active</span>
                                    }
                                    else if (loan.Status == LibraryManagementSystem.Models.LoanStatus.Overdue)
                                    {
                                        <span class="inline-flex rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800">Overdue</span>
                                    }
                                    else
                                    {
                                        <span class="inline-flex rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800">Returned</span>
                                    }
                                </td>
                                <td class="px-4 py-3 text-sm @(loan.FineAmount > 0 ? "text-red-600 font-medium" : "text-gray-500")">
                                    @(loan.FineAmount > 0 ? $"${loan.FineAmount:F2}" : "-")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>